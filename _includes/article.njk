{% extends "layout.njk" %}

{# --- Page Variables --- #}
{% set pageTitle = title %}
{% set pageDesc = description or excerpt or "Latest news from FGC Top Players." %}

{# Explicitly set the default image so Schema and Social Tags match perfectly #}
{% set image = '/images/fgc-top-players-social-card.png' %}

{# --- Block Overrides --- #}

{% block title %}{{ pageTitle }} | FGC Top Players{% endblock %}

{% block meta_description %}
<meta name="description" content="{{ pageDesc }}">
{% endblock %}

{# Ensure social cards show the specific article title/desc #}
{% block og_title %}{{ pageTitle }}{% endblock %}
{% block og_description %}{{ pageDesc }}{% endblock %}

{% block twitter_title %}{{ pageTitle }}{% endblock %}
{% block twitter_description %}{{ pageDesc }}{% endblock %}

{# --- Structured Data (NewsArticle) --- #}
{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ site.url }}{{ page.url | url }}" 
  },
  "headline": {{ pageTitle | dump | safe }},
  "image": [
    "{{ site.url }}{{ image }}"
  ],
  "datePublished": "{{ date | date('yyyy-MM-ddTHH:mm:ssZZ') }}",
  "dateModified": "{{ date | date('yyyy-MM-ddTHH:mm:ssZZ') }}",
  "author": {
    "@type": "Person",
    "name": {{ (authorName or 'FGC Top Players') | dump | safe }}
  },
  "publisher": {
    "@type": "Organization",
    "name": "FGC Top Players",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.url }}/images/logo.png"
    }
  },
  "description": {{ pageDesc | dump | safe }}
}
</script>
{% endblock %}

{% block content %}
{% include "banner.njk" %}

<div class="article-page page-article">
  <article class="article-post">

    <header class="article-post__header">
      <h1 class="article-post__title">{{ title }}</h1>
      <div class="article-post__meta">
        <span class="article-post__date">
          <i class="fas fa-calendar-alt" aria-hidden="true"></i>
          {{ date | readableDate }}
        </span>
        {% if tags and (tags | reject('eq', 'news')).length > 0 %}
        <div class="article-post__tags">
          <i class="fas fa-tags" aria-hidden="true"></i>
          {% for tag in tags %}
            {% if tag != 'news' %}
              <a href="{{ ('/tags/' + (tag | slugify) + '/') | url }}" class="article-post__tag">{{ tag }}</a>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </header>
    
    <div class="article-post__body">
      {{ content | autoLink(page, collections, playerProfiles) | safe }}
    </div>

    {# --- RELATED ARTICLES SECTION START --- #}
    {% set relatedPosts = collections.news | getRelated(page.url, tags) %}
    
    {% if relatedPosts | length > 0 %}
    <aside class="related-articles">
      <hr class="hr-gradient--center-blue">
      
      <h3 class="related-articles__heading">Related News</h3>
      
      <div class="related-grid">
        {% for post in relatedPosts %}
            <article class="home-card">
              <a href="{{ post.url }}" class="home-card__link">
                <div class="home-card__content">
                  <span class="home-card__date">
                    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                    {{ post.date | readableDate }}
                  </span>
                  <h4 class="home-card__title">{{ post.data.title }}</h4>
                  
                  {% if post.data.excerpt %}
                  <div class="home-card__excerpt">
                    <p>{{ post.data.excerpt | truncate(100) }}</p>
                  </div>
                  {% endif %}

                  <div class="home-card__footer">
                    <div class="home-card__tags">
                      {% for tag in post.data.tags | slice(0,3) %}
                        {% if tag != 'news' %}
                          <span class="home-card__tag">{{ tag }}</span>
                        {% endif %}
                      {% endfor %}
                    </div>
                    <span class="btn btn--small btn--primary home-card__read-more">Read More</span>
                  </div>
                </div>
              </a>
            </article>
        {% endfor %}
      </div>
    </aside>
    {% endif %}
    {# --- RELATED ARTICLES SECTION END --- #}

    <footer class="article-post__footer">
      
      <hr class="hr-gradient">

      <div class="article-post__share">
        <span class="article-post__share-label">Share this article:</span>
        <div class="article-post__share-buttons">
          <a href="#"
             onclick="window.open('https://x.com/intent/tweet?text=' + encodeURIComponent(document.title) + '&url=' + encodeURIComponent(window.location.href), '_blank', 'width=550,height=420'); return false;"
             class="btn-social btn-social--twitter"
             aria-label="Share on X (formerly Twitter)">
            <i class="fab fa-x-twitter" aria-hidden="true"></i>
          </a>

          <a href="#"
             onclick="window.open('https://www.facebook.com/dialog/share?app_id=145634995501895&display=popup&href=' + encodeURIComponent(window.location.href) + '&quote=' + encodeURIComponent(document.title), '_blank', 'width=550,height=420'); return false;"
             class="btn-social btn-social--facebook"
             aria-label="Share on Facebook">
            <i class="fab fa-facebook-f" aria-hidden="true"></i>
          </a>

          <a href="#"
             onclick="window.open('https://www.reddit.com/submit?url=' + encodeURIComponent(window.location.href) + '&title=' + encodeURIComponent(document.title), '_blank', 'width=550,height=420'); return false;"
             class="btn-social btn-social--reddit"
             aria-label="Share on Reddit">
            <i class="fab fa-reddit-alien" aria-hidden="true"></i>
          </a>

          <button class="btn-social btn-social--copy"
                  onclick="navigator.clipboard.writeText(window.location.href); this.innerHTML='<i class=\'fas fa-check\' aria-hidden=\'true\'></i>'; setTimeout(() => this.innerHTML='<i class=\'fas fa-copy\' aria-hidden=\'true\'></i>', 2000)"
                  aria-label="Copy link">
            <i class="fas fa-copy" aria-hidden="true"></i>
          </button>
        </div>
      </div>

      <nav class="article-post__nav" aria-label="Article navigation">
        <a href="javascript:void(0);" onclick="smartGoBack();" class="btn btn--primary">
          <i class="fas fa-arrow-left" aria-hidden="true"></i> Back to News
        </a>
      </nav>
    </footer>

  </article>
</div>
{% endblock %}